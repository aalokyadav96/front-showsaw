import "../../../css/ui/AudioPlayer.css";

function AudioPlayer(audioSrc) {
  console.log(audioSrc);
  // Create player container
  const player = document.createElement("div");
  player.id = "audio-player-container";

  // Poster image
  const img = document.createElement("img");
  img.src = audioSrc.poster;
  img.alt = "Audio Thumbnail";
  img.className = "audio-poster";
  player.appendChild(img);

  // Audio element
  const audio = document.createElement("audio");
  audio.src = audioSrc.src;
  audio.controls = false; // Custom controls
  player.appendChild(audio);

  // Play/Pause button
  const playButton = document.createElement("button");
  playButton.textContent = "Play";
  playButton.onclick = function () {
    if (audio.paused) {
      audio.play();
      playButton.textContent = "Pause";
    } else {
      audio.pause();
      playButton.textContent = "Play";
    }
  };
  player.appendChild(playButton);

  // **Seek Bar**
  const seekBar = document.createElement("input");
  seekBar.type = "range";
  seekBar.min = 0;
  seekBar.max = 100;
  seekBar.value = 0;
  seekBar.className = "seek-bar";
  player.appendChild(seekBar);

  audio.addEventListener("timeupdate", () => {
    seekBar.value = (audio.currentTime / audio.duration) * 100;
  });

  seekBar.addEventListener("input", () => {
    audio.currentTime = (seekBar.value / 100) * audio.duration;
  });

  // **Volume Control**
  const volumeSlider = document.createElement("input");
  volumeSlider.type = "range";
  volumeSlider.min = 0;
  volumeSlider.max = 1;
  volumeSlider.step = 0.1;
  volumeSlider.value = audio.volume;
  volumeSlider.className = "volume-slider";
  player.appendChild(volumeSlider);

  volumeSlider.addEventListener("input", () => {
    audio.volume = volumeSlider.value;
  });

  // **Playback Speed Control**
  const speedSelect = document.createElement("select");
  [0.5, 1, 1.5, 2].forEach(speed => {
    const option = document.createElement("option");
    option.value = speed;
    option.textContent = `${speed}x`;
    speedSelect.appendChild(option);
  });
  speedSelect.className = "speed-select";
  player.appendChild(speedSelect);

  speedSelect.addEventListener("change", () => {
    audio.playbackRate = speedSelect.value;
  });

  // **Lyrics Syncing**
  const lyricsContainer = document.createElement("div");
  lyricsContainer.id = "lyrics-container";
  player.appendChild(lyricsContainer);

  audio.addEventListener("timeupdate", () => {
    const currentTime = audio.currentTime;
    const currentLyrics = audioSrc.lyricsData.find(l => currentTime >= l.time);
    if (currentLyrics) {
      lyricsContainer.textContent = currentLyrics.text;
    }
  });

  // // Close button
  // const closeButton = document.createElement("button");
  // closeButton.textContent = "Close";
  // closeButton.onclick = function () {
  //   closeAudioPlayer();
  // };
  // player.appendChild(closeButton);

  // document.body.appendChild(player);

  function closeAudioPlayer() {
    if (document.body.contains(player)) {
      player.remove();
      history.back();
    }
  }

  return player;
}

export default AudioPlayer;
